<!DOCTYPE html>
<html>

<head>
  
  <title>学习日记20.01.02 - 时间胶囊</title>
  <meta charset="UTF-8">
  <meta name="description" content="我与你的轻时光">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  

  <link rel="shortcut icon" href="/images/favicon.ico" type="image/vnd.microsoft.icon" />
  <meta name="description" content="今天下午在学习的过程中，对MVC模式又探索了一步。同时也知道了一些各种的小知识点。">
<meta property="og:type" content="article">
<meta property="og:title" content="学习日记20.01.02">
<meta property="og:url" content="https://timecan.ml/2020/01/02/%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B020.01.02/index.html">
<meta property="og:site_name" content="时间胶囊">
<meta property="og:description" content="今天下午在学习的过程中，对MVC模式又探索了一步。同时也知道了一些各种的小知识点。">
<meta property="og:locale" content="zh">
<meta property="article:published_time" content="2020-01-02T09:31:25.000Z">
<meta property="article:modified_time" content="2020-01-06T03:55:32.027Z">
<meta property="article:author" content="ILSH·M">
<meta property="article:tag" content="js">
<meta property="article:tag" content="MVC">
<meta name="twitter:card" content="summary">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/css/mdui.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.15.8/styles/atom-one-dark.css">
   
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1038733_0xvrvpg9c0r.css">
  <link rel="stylesheet" href="/css/style.css?v=1581240922413">
<meta name="generator" content="Hexo 4.2.0"></head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(https://i.loli.net/2020/01/06/kewAqLjBR21ZzTU.png)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">menu</i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="ILSH·M" class="mdui-btn mdui-btn-icon"><img src="/images/avatar.jpg"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="ILSH·M">
            <img src="/images/avatar.jpg" alt="ILSH·M">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>Articles</span>11</div>
        <div><span>Tags</span>20</div>
        <div><span>Categories</span>4</div>
    </div>
    <ul class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about.html" title="关于博客">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博客
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/PY.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
    </ul>
    <aside id="nexmoe-sidebar">
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Social</h3>
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://github.com/moseay" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a><a class="mdui-ripple" href="https://t.me/White_Two" target="_blank" mdui-tooltip="{content: 'Telegram'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-telegram"></i>
        </a><a class="mdui-ripple" href="https://twitter.com/_mos_ae?s=09" target="_blank" mdui-tooltip="{content: 'Twitter'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-twitter"></i>
        </a><a class="mdui-ripple" href="tencent://message/?uin=824665292&Site=&Menu=yes" target="_blank" mdui-tooltip="{content: 'QQ'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-QQ"></i>
        </a>
    </div>
</div>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Categories</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/javaweb/">javaweb</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/博客日杂/">博客日杂</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/心事/">心事</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/随笔/">随笔</a>
          <span class="category-list-count">1</span>
        </li>

        
      </ul>

    </div>
  </div>


  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Tagcloud</h3>
    <div id="randomtagcloud" class="nexmoe-widget tagcloud">
      <a href="/tags/MVC/" style="font-size: 10px;">MVC</a> <a href="/tags/c3p0/" style="font-size: 10px;">c3p0</a> <a href="/tags/dbutils/" style="font-size: 10px;">dbutils</a> <a href="/tags/filter/" style="font-size: 10px;">filter</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/listener/" style="font-size: 10px;">listener</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/%E4%B9%90%E8%A7%82/" style="font-size: 10px;">乐观</a> <a href="/tags/%E4%BD%A0%E7%9A%84%E5%90%8D%E5%AD%97/" style="font-size: 10px;">你的名字</a> <a href="/tags/%E5%88%86%E9%A1%B5/" style="font-size: 10px;">分页</a> <a href="/tags/%E5%AD%A4%E7%8B%AC/" style="font-size: 10px;">孤独</a> <a href="/tags/%E5%BF%83%E4%BA%8B/" style="font-size: 20px;">心事</a> <a href="/tags/%E6%9B%BE%E7%BB%8F/" style="font-size: 10px;">曾经</a> <a href="/tags/%E6%9C%AA%E6%9D%A5/" style="font-size: 10px;">未来</a> <a href="/tags/%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2/" style="font-size: 10px;">条件查询</a> <a href="/tags/%E6%A2%A6%E5%A2%83/" style="font-size: 10px;">梦境</a> <a href="/tags/%E7%8E%B0%E5%9C%A8/" style="font-size: 10px;">现在</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 10px;">生活</a> <a href="/tags/%E8%87%AA%E6%88%91/" style="font-size: 10px;">自我</a>
    </div>
    
  </div>

  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Archive</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li></ul>
    </div>
  </div>


  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2020 ILSH·M
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://nexmoe.com/hexo-theme-nexmoe.html" target="_blank">Nexmoe</a>
    </div>
</div><!-- .nexmoe-drawer -->
  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <div class="nexmoe-post">
    <div class="nexmoe-post-cover"> 
        
        <img src="https://cdn.pixabay.com/photo/2018/04/29/01/22/tea-plantation-3358870_1280.jpg">
        
        <h1>学习日记20.01.02</h1>
    </div>
  <div class="nexmoe-post-meta">
    <a><i class="nexmoefont icon-calendar-fill"></i>2020年01月02日</a>
    <a><i class="nexmoefont icon-areachart"></i>2.2k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 9 分钟</a>
    
      <a class="nexmoefont icon-appstore-fill -link" href="/categories/javaweb/">javaweb</a>
    
    
      <a class="nexmoefont icon-tag-fill -link" href="/tags/MVC/" rel="tag">MVC</a> <a class="nexmoefont icon-tag-fill -link" href="/tags/js/" rel="tag">js</a>
    
  </div>
  <article>
    <p>今天下午在学习的过程中，对MVC模式又探索了一步。同时也知道了一些各种的小知识点。</p>
<a id="more"></a>

<h2 id="起初"><a href="#起初" class="headerlink" title="起初"></a>起初</h2><p>我今天的学习是关于商品的删除操作，在给定好的页面上，点击删除的按钮，就将对应的商品删除。首先，这个业务是删除对应的商品。所以需要知道“应该删除哪个商品”，因此，在删除时需要告知后端“被删除的商品的pid”。</p>
<h2 id="删除商品功能"><a href="#删除商品功能" class="headerlink" title="删除商品功能"></a>删除商品功能</h2><h3 id="点击按钮删除单个商品"><a href="#点击按钮删除单个商品" class="headerlink" title="点击按钮删除单个商品"></a>点击按钮删除单个商品</h3><p>我们可以通过js，将前端商品的删除功能大致的写一下，如下：</p>
<pre><code class="js">function delProductById(){
                var isTrue = confirm(&quot;您确定要删除该商品吗？&quot;);
                if(isTrue){
                                        //执行商品删除操作
                }
            }</code></pre>
<p>此处我们可以进行思考，如何得到商品的pid呢？在载入页面时，后端会将所有的商品的所有信息包装到List集合中，而在jsp中通过EL表达式，我们可以轻易的获取到商品的id。通过<code>location.href=&quot;${pageContext.request.contextPath}/adminDelProductById?pid=${pro.pid}&quot;;</code>该语句，按理来说的确获取到了pid进行删除，因为在执行此操作前已经通过循环将集合中的元素通过foreach循环逐个取出。</p>
<p>但是，这样做真的能够取出对应的元素吗？答案是否定的，不能。因为pro是通过for循环遍历出的，所以在页面加载完毕后，pro对象只能是商品集合中最后一个元素。而不是我们需要的“对应商品”，那么该怎么办呢？</p>
<p>其实很轻松就能做到，主要是要树立一些思想：我们所有需要传参的操作，都是需要从前台传参到后端的；而在html中，并不是所有有用的元素都要“<strong>显式</strong>”的显示在页面上；还有，EL表达式能填入到jsp中的各个地方；我们并不是非要在使用时再去获取信息，我们可以在一开始就准备好需要用到的信息。</p>
<p>有了这个思想（前提），我们就可以这么改写那句代码。</p>
<p>首先，我们的删除按钮上已经写好了一个事件，对应上文的<code>delProductById()</code>方法。我们既然需要每个商品在点击删除时，都能得到该商品的id。那么我们可以思考，只有在<code>&lt;c:forEach&gt;</code>循环时，才能获取各个商品的pid。</p>
<p>根据上文写到的“ 我们可以在一开始就准备好需要用到的信息 ”，我们完全可以这在循环时，将pid信息插入到html中，与商品信息一一对应，这样在调用删除功能时，我们就可以直接获取到对应的商品id。虽然我们可以把它隐式的嵌入到html中，但是最简单的方法还是直接嵌入到 <code>delProductById()</code> 的参数中。代码如下：</p>
<pre><code class="html">&lt;td align=&quot;center&quot; style=&quot;HEIGHT: 22px&quot;&gt;
    &lt;a href=&quot;javascript:void(0)&quot; onclick=&quot;delProductById(&#39;${pro.pid}&#39;)&quot;&gt; 
        &lt;img src=&quot;${pageContext.request.contextPath}/images/i_del.gif&quot;    width=&quot;16&quot; height=&quot;16&quot; border=&quot;0&quot; style=&quot;CURSOR: hand&quot;&gt;
    &lt;/a&gt;
&lt;/td&gt;</code></pre>
<p>主要就是其中的<code>onclick=&quot;delProductById(&#39;${pro.pid}&#39;)&quot;</code>，我们直接通过EL表达式将pid嵌入到html中，嵌入到了方法的参数内部。而在动态生成商品信息的时候，每一个pid都能对应上对应的商品。在js中只需要稍作修改，就可以实现“删除对应的商品”功能。js代码如下：</p>
<pre><code class="js">function delProductById(pid){
                var isTrue = confirm(&quot;您确定要删除该商品吗？&quot;);
                if(isTrue){
                            location.href = &quot;${pageContext.request.contextPath}/adminDelProductById?pid=&quot; + pid;
                }
            }</code></pre>
<h3 id="批量删除功能"><a href="#批量删除功能" class="headerlink" title="批量删除功能"></a>批量删除功能</h3><p>与直接删除不同的是，批量删除并没有直接在界面中给定，因此我通过百度，得到了复选框的html标签，以及一些相关知识。</p>
<p>首先在表头设置一个新列，直接将单元格的内容设置为按钮。此处需要注意的是，在给定的页面中，所有的信息都包含在一个很大的表单中，如果直接使用<code>&lt;button&gt;</code>标签，或者<code>&lt;input type=&quot;submit&quot;&gt;</code>标签，都会导致在事件执行后，提交表单。造成无法预知的后果（在此处，直接会报错，因为表单的action指向不存在的页面）。因此，在单元格中，我们可以使用<code>&lt;input type=&quot;button&quot;&gt;</code>来避免这样的后果。该单元格的代码如下：</p>
<pre><code class="html">&lt;td width=&quot;7%&quot; align=&quot;center&quot;&gt;
    &lt;input type=&quot;button&quot; onclick=&quot;muiltDelProduct()&quot; value=&quot;批量删除&quot;&gt;
&lt;/td&gt;</code></pre>
<p>在foreach循环内部，多增一列，这列的单元格内容就是复选框。对应刚设置好的表头，代码如下：</p>
<pre><code class="html">&lt;td align=&quot;center&quot; style=&quot;HEIGHT: 22px&quot;&gt;
    &lt;input type=&quot;checkbox&quot; value=&quot;${pro.pid}&quot; name=&quot;muiltDel&quot;&gt;
&lt;/td&gt;</code></pre>
<p>这样就会在循环生成商品信息的时候，将对应的pid与对应的多选框绑定起来。</p>
<p>多选后点击按钮，则执行如下js：</p>
<pre><code class="js">function muiltDelProduct(){
                //注意，如果按钮在表单中，使用button和&lt;input type submit&gt;都会直接提交表单...
                var obj = document.getElementsByName(&quot;muiltDel&quot;);
                var check_val = [];
                var isNoneChecked = true;
                for(k in obj){
                    if(obj[k].checked){
                        check_val.push(obj[k].value);
                        isNoneChecked = false;
                    }

                }
                if(isNoneChecked){
                    alert(&quot;您还未选中任何要删除的商品！&quot;);
                    return;
                }
                var isTrue = confirm(&quot;您确定要删除  &quot; +check_val+ &quot;  这些商品吗？&quot;);
                if(isTrue){
                            location.href = &quot;${pageContext.request.contextPath}/adminDelProductById?pids=&quot; + check_val;
                }
            }</code></pre>
<p>其中，通过<code>var obj = document.getElementsByName(&quot;muiltDel&quot;);</code>获取所有复选框对象，然后就可以直接获取其状态，如果被勾选，则将对应的值（pid）推入到数组中。另外，为了防止用户没有选择任何项却点击了按钮，此处使用了一个boolean型变量进行判断。</p>
<h2 id="后端业务"><a href="#后端业务" class="headerlink" title="后端业务"></a>后端业务</h2><p>我们可以很明显的看到，上文的js中，无论是单个删除与多选删除，我们都是访问的同一个servlet。因为我认为，单选和多选其实是同一个业务，没有必要写两个servlet。</p>
<p>那么在后端是如何识别呢？我一开始是判断，pid是否为空。因为后端是同时获取pid与pids，因此如果pid为空，那么一定是批量删除。这样的话原来单个删除的代码不变，只是在Pid为空时，执行多选的删除操作。</p>
<p>但是之后，我想到这样的代码未免比较重复。因为同时写了一套批量删除，还保留了之前的单个删除的功能。因此，我决定将他们优化一番。</p>
<p>可以想到，其实在批量删除中，它包含了删除功能。所以，如果我们将单个删除的pid直接放入到批量删除中，不就减少了重复代码吗？</p>
<p>所以我就这样写了：</p>
<pre><code class="java">if (pid != null &amp;&amp; !&quot;&quot;.equals(pid)) {
            pids = pid;
        }
String[] pidtmp = pids.split(&quot;,&quot;);
for (String eachPid : pidtmp) {
    service.delProductById(eachPid);
}</code></pre>
<p>很明显，在pid不为空时，肯定不会是批量删除。此时pids一定是null，所以我们就直接将pid赋给pids，这样在分割文本时，由于pids中 没有“,”就会直接变成一个只有一个元素的数组，而这个元素就是一开始的pid。在循环遍历中也能得出对应的数据进行删除。</p>
<p>同时，在批量删除时，pid一定为null，那么就不执行<code>pids=pid</code>这项操作，那么直接分割文本进行循环删除也可以实现。</p>
<p>这样其实已经很完美了，但是我又突然想到，根据MVC模式，将javaWeb应用分为三层：web、service、dao。而dao层是持久化数据，service层是业务逻辑处理，web层获取前端数据，处理数据。</p>
<p>我们的web层一般来说，只需要获取前端的数据，对数据进行封装就OK，没有必要把业务层的逻辑处理放在web层。虽然这只是一个很小的程序功能业务，但是这也是一种思想。因此，我就将对pid与pids的判断放入了service层。</p>
<p>这样web层接到pid与pids，无论是否为null都直接传入到service层，在service层进行判断以及进行操作。service层的对应方法如下：</p>
<pre><code class="java">public void delProductById(String pid, String pids) throws SQLException {
        AdminProductDao dao = new AdminProductDao();
        if (pid != null &amp;&amp; !&quot;&quot;.equals(pid)) {
            pids = pid;
        }
        String[] pidtmp = pids.split(&quot;,&quot;);
        for (String eachPid : pidtmp) {
            dao.delProductById(eachPid);
        }
    }</code></pre>
<p>至此，关于今天下午学习的商品删除的课程中遇到的知识点已经结束。</p>

  </article>
  
    
<div class="nexmoe-post-copyright">
<i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
<strong>Author：</strong>ILSH·M<br>
<strong>Link：</strong><a href="https://timecan.ml/2020/01/02/%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B020.01.02/" title="https:&#x2F;&#x2F;timecan.ml&#x2F;2020&#x2F;01&#x2F;02&#x2F;%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B020.01.02&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;timecan.ml&#x2F;2020&#x2F;01&#x2F;02&#x2F;%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B020.01.02&#x2F;</a><br>

  <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可

</div>


  
  <section class="nexmoe-comment">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.min.css">
<div id="gitalk"></div>
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.min.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        id: decodeURI(window.location.pathname),
        repo: '',
        owner: '',
        admin: ''
    })
    gitalk.render('gitalk')
</script>

</section>
</div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/js/mdui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
 
    <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>


 
    <script src="https://cdn.jsdelivr.net/npm/smoothscroll-for-websites@1.4.9/SmoothScroll.min.js"></script>


<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.8/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="/js/app.js?v=1581240922422"></script>
<script src="https://cdn.jsdelivr.net/npm/lazysizes@5.1.0/lazysizes.min.js"></script>


    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/xtaodada/xtaodada.github.io@0.0.2/copy.js"></script>



  





</body>

</html>
